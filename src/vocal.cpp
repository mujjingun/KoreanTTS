#include <random>

#include "vocal.h"
#include "soundio.h"
#include "formants.h" // linear()

fpoint srcwave[] =
{
-0.08179,-0.08939,0.07334,0.19059,0.34040,0.46318,0.56215,
0.61345,0.64757,0.65075,0.66073,0.67013,0.68419,0.68984,
0.69189,0.67586,0.65609,0.62679,0.59252,0.55135,0.51027,
0.46635,0.42970,0.39534,0.36152,0.32420,0.28547,0.24726,
0.21915,0.20118,0.19123,0.18464,0.17777,0.16926,0.16123,
0.15201,0.13898,0.12195,0.10236,0.08493,0.07196,0.06030,
0.04199,0.01245,-0.02899,-0.07443,-0.11585,-0.14710,-0.16916,
-0.18357,-0.19419,-0.20081,-0.20551,-0.21018,-0.22034,-0.23838,
-0.26551,-0.29725,-0.33039,-0.36232,-0.39558,-0.43165,-0.47102,
-0.50813,-0.53740,-0.55385,-0.55940,-0.55846,-0.55708,-0.55733,
-0.55950,-0.56209,-0.56551,-0.56911,-0.57118,-0.56667,-0.55113,
-0.52226,-0.48241,-0.43556,-0.38542,-0.33299,-0.27851,-0.22260,
-0.16764,-0.11609,-0.06949,-0.02792,0.00916,0.04257,0.07340,
0.10364,0.13559,0.17045,0.20692,0.24155,0.27021,0.29002,
0.30027,0.30204,0.29719,0.28779,0.27601,0.26389,0.25315,
0.24482,0.23899,0.23539,0.23350,0.23307,0.23350,0.23371,
0.23179,0.22596,0.21503,0.19932,0.18039,0.16068,0.14234,
0.12699,0.11539,0.10724,0.10111,0.09482,0.08631,0.07498,
0.06198,0.04968,0.03992,0.03308,0.02802,0.02338,0.01825,
0.01273,0.00717,0.00192,-0.00302,-0.00778,-0.01282,-0.01910,
-0.02795,-0.04022,-0.05542,-0.07154,-0.08615,-0.09769,-0.10620,
-0.11280,-0.11902,-0.12583,-0.13361,-0.14188,-0.14969,-0.15571,
-0.15879,-0.15854,-0.15558,-0.15131,-0.14695,-0.14261,-0.13736,
-0.12995,-0.11985,-0.10773,-0.09522,-0.08386,-0.07447,-0.06687,
-0.06034,-0.05396,-0.04678,-0.03784,-0.02631,-0.01205,0.00394,
0.01981,0.03409,0.04630,0.05707,0.06745,0.07776,0.08771,
0.09723,0.10715,0.11875,0.13257,0.14789,0.16306,0.17710,
0.19016,0.20304,0.21601,0.22831,0.23887,0.24732,0.25443,
0.26106,0.26743,0.27305,0.27741,0.28059,0.28312,0.28544,
0.28758,0.28944,0.29093,0.29203,0.29212,0.29020,0.28562,
0.27891,0.27216,0.26768,0.26673,0.26890,0.27253,0.27619,
0.27937,0.28227,0.28523,0.28819,0.29081,0.29301,0.29484,
0.29624,0.29655,0.29484,0.29093,0.28611,0.28272,0.28300,
0.28742,0.29481,0.30311,0.31117,0.31904,0.32765,0.33726,
0.34754,0.35792,0.36824,0.37855,0.38859,0.39720,0.40349,
0.40770,0.41188,0.41826,0.42790,0.43971,0.45170,0.46229,
0.47154,0.48018,0.48897,0.49812,0.50789,0.51872,0.53069,
0.54237,0.55138,0.55528,0.55385,0.54906,0.54360,0.53880,
0.53383,0.52663,0.51588,0.50157,0.48433,0.46449,0.44191,
0.41682,0.39051,0.36451,0.33894,0.31175,0.28004,0.24213,
0.19916,0.15427,0.11026,0.06790,0.02622,-0.01602,-0.05890,
-0.10175,-0.14408,-0.18628,-0.22843,-0.26957,-0.30711,-0.33903,
-0.36430,-0.38377,-0.39772,-0.40580,-0.40611,-0.39839,-0.38334,
-0.36396,-0.34202,-0.31938,-0.29606,-0.27418,-0.25517,-0.24155,
-0.23197,-0.22501,-0.21717,-0.20905,-0.20139,-0.19803,-0.19858,
-0.20310,-0.20753,-0.21097,-0.21146,-0.21107,-0.20887,-0.20762,
-0.20698,-0.20994,-0.21625,-0.22739,-0.23917,-0.25156,-0.26243,
-0.27549,-0.29392,-0.32267,-0.35994,-0.40550,-0.45344,-0.50099,
-0.54549,-0.58650,-0.62200,-0.65563,-0.68853,-0.72396,-0.76440,
-0.80657,-0.84497,-0.87698,-0.90069,-0.91760,-0.93542,-0.95206,
-0.96817,-0.98148,-0.99060,-0.99246,-0.99762,-0.99808,-1.00000,
-0.99615,-0.98093,-0.93545,-0.87017,-0.76119,-0.63903,-0.50932,
-0.39805,-0.27973,-0.23783
};

fpoint osc_get_sample(fpoint x)
{
    int len = 367;
    int ind1 = int(x * len);
    return linear(srcwave[ind1], srcwave[ind1 + 1], x, ind1, ind1 + 1);
}

std::default_random_engine noise_generator;
std::normal_distribution<fpoint> gauss_distribution(0, 1.0);

fpoint osc_noise()
{
    return clamp(-1, 1, gauss_distribution(noise_generator));
}
